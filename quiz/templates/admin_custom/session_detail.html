{% extends 'admin_custom/base.html' %}

{% block title %}Session Details - Admin Panel{% endblock %}

{% block content %}
<h2 style="margin-bottom: 30px;">Session Details</h2>

<div class="card">
    <h3>Session Information</h3>
    <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
            <strong>User:</strong> {{ session.access_code.name }}<br>
            <strong>Access Code:</strong> {{ session.access_code.code }}<br>
            <strong>Test:</strong> {{ session.test.title }}<br>
            <strong>Subject:</strong> {{ session.test.subject.name }}
        </div>
        <div>
            <strong>Score:</strong> {{ session.score }}%<br>
            <strong>Correct Answers:</strong> {{ session.correct_answers }}/{{ session.total_questions }}<br>
            <strong>Started:</strong> {{ session.started_at|date:"Y-m-d H:i" }}<br>
            <strong>Completed:</strong> {{ session.completed_at|date:"Y-m-d H:i" }}
        </div>
    </div>
</div>

<div class="card">
    <h3>Detailed Answers</h3>
    <div style="margin-top: 20px;">
        {% for answer in answers %}
        <div style="background: {% if answer.is_correct %}#d4edda{% else %}#f8d7da{% endif %}; padding: 15px; margin-bottom: 15px; border-radius: 5px; border-left: 4px solid {% if answer.is_correct %}#27ae60{% else %}#e74c3c{% endif %};">
            <div style="margin-bottom: 10px;">
                <strong>Q{{ answer.question.order }}: {{ answer.question.text }}</strong>
            </div>
            <div style="margin-left: 20px;">
                <div style="margin-bottom: 5px;">
                    <strong>User's Answer:</strong> 
                    {% if answer.selected_option %}
                        {{ answer.selected_option.text }}
                    {% else %}
                        <em>Not answered</em>
                    {% endif %}
                </div>
                {% if not answer.is_correct %}
                <div style="color: #27ae60;">
                    <strong>Correct Answer:</strong> 
                    {% for option in answer.question.options.all %}
                        {% if option.is_correct %}{{ option.text }}{% endif %}
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<a href="{% url 'admin_results' %}" class="btn btn-secondary">Back to Results</a>
{% endblock %}
